<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin CMS - Amarac BPA</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Nunito:wght@400;600&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background: #f0f2f5;
            color: #222525;
        }

        .sidebar {
            height: 100vh;
            background: #222525;
            color: white;
            padding: 30px 20px;
            position: sticky;
            top: 0;
        }

        .nav-link {
            color: #8e9499;
            margin-bottom: 12px;
            border-radius: 12px;
            padding: 12px 15px;
            display: flex;
            align-items: center;
            transition: all 0.2s;
            text-decoration: none;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(244, 93, 72, 0.1);
            color: #F45D48;
        }

        .nav-link.active {
            background: #F45D48;
            color: white;
        }

        .main-content {
            padding: 40px;
        }

        .card {
            border: none;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.03);
            margin-bottom: 30px;
        }

        .btn-primary {
            background: #F45D48;
            border: none;
            border-radius: 12px;
            padding: 12px 25px;
            font-weight: 600;
        }

        .btn-primary:hover {
            background: #d84b38;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244, 93, 72, 0.3);
        }

        .status-pill {
            padding: 6px 15px;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 700;
        }

        .table {
            --bs-table-bg: transparent;
        }

        .table thead th {
            border-top: none;
            color: #8e9499;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
    </style>
</head>

<body>
    <div class="container-fluid p-0">
        <div class="d-flex">
            <!-- Sidebar -->
            <div class="sidebar col-md-2 d-none d-md-block">
                <div class="mb-5 px-3">
                    <h4 class="fw-bold mb-0">AMARAC<span style="color:#F45D48">BPA</span></h4>
                    <p class="small opacity-50">Enterprise CMS</p>
                </div>
                <nav class="nav flex-column">
                    <a class="nav-link active" href="#" onclick="showSection('dashboard')"><i
                            class='bx bxs-dashboard me-3 fs-5'></i> Dashboard</a>
                    <a class="nav-link" href="#" onclick="showSection('pages')"><i
                            class='bx bx-paper-plane me-3 fs-5'></i> Site Pages</a>
                    <a class="nav-link" href="#" onclick="showSection('leads')"><i
                            class='bx bx-user-voice me-3 fs-5'></i> Inbox / Leads</a>
                    <div class="mt-5 pt-5">
                        <a class="nav-link" href="/"><i class='bx bx-log-out me-3 fs-5'></i> View Website</a>
                    </div>
                </nav>
            </div>

            <!-- Main Content Area -->
            <div class="main-content col-md-10 col-12">

                <!-- Dashboard Section -->
                <div id="section-dashboard">
                    <div class="d-flex justify-content-between align-items-center mb-5">
                        <h2 class="fw-bold m-0">Global Settings</h2>
                        <div class="d-flex align-items-center gap-3">
                            <div class="status-pill bg-success-subtle text-success">SYSTEM ONLINE</div>
                            <div class="small opacity-50">v4.2.0-stable</div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card p-4">
                                <h5 class="fw-bold mb-4">Homepage Identity</h5>
                                <form id="hero-form">
                                    <div class="mb-3">
                                        <label class="form-label small text-muted">Hero Heading</label>
                                        <input type="text" class="form-control bg-light border-0 p-3"
                                            id="form-hero-title">
                                    </div>
                                    <div class="mb-4">
                                        <label class="form-label small text-muted">Hero Subheading</label>
                                        <textarea class="form-control bg-light border-0 p-3" id="form-hero-subtitle"
                                            rows="3"></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Update Global Identity</button>
                                </form>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="card p-4 bg-navy text-white" style="background: #222525;">
                                <h5 class="fw-bold mb-4">Quick Stats</h5>
                                <div class="mb-4">
                                    <h2 class="fw-bold mb-0" id="stat-leads">0</h2>
                                    <p class="small opacity-50">New Lead Inquiries</p>
                                </div>
                                <div class="mb-0">
                                    <h2 class="fw-bold mb-0" id="stat-products">11</h2>
                                    <p class="small opacity-50">Active Modules</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pages Section -->
                <div id="section-pages" style="display:none">
                    <div class="d-flex justify-content-between align-items-center mb-5">
                        <h2 class="fw-bold">Product Content Manager</h2>
                    </div>
                    <div class="card p-0 overflow-hidden">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="bg-light">
                                    <tr>
                                        <th class="ps-4">Icon</th>
                                        <th>Module Name</th>
                                        <th>Tagline</th>
                                        <th>URL Slug</th>
                                        <th class="text-end pe-4">Manage</th>
                                    </tr>
                                </thead>
                                <tbody id="products-table"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Leads Section -->
                <div id="section-leads" style="display:none">
                    <h2 class="fw-bold mb-5">Request Inbox</h2>
                    <div class="card p-0 overflow-hidden">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="bg-light">
                                    <tr>
                                        <th class="ps-4">Sender</th>
                                        <th>Module Interaction</th>
                                        <th>Message Snippet</th>
                                        <th>Date Received</th>
                                    </tr>
                                </thead>
                                <tbody id="leads-table"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0" style="border-radius: 20px;">
                <div class="modal-header border-0 p-4">
                    <h4 class="fw-bold m-0">Edit Module Strategy</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <input type="hidden" id="edit-id">
                    <div class="row g-4">
                        <div class="col-md-6">
                            <label class="form-label small text-muted">Module Label</label>
                            <input type="text" class="form-control bg-light border-0 p-3" id="edit-name">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small text-muted">URL Slug (Keep it clean)</label>
                            <input type="text" class="form-control bg-light border-0 p-3" id="edit-slug">
                        </div>
                        <div class="col-12">
                            <label class="form-label small text-muted">Catchy Page Title (Selling Caption)</label>
                            <input type="text" class="form-control bg-light border-0 p-3" id="edit-tagline">
                        </div>
                        <div class="col-12">
                            <label class="form-label small text-muted">Condensed Pitch (Homepage Card)</label>
                            <textarea class="form-control bg-light border-0 p-3" id="edit-desc" rows="2"></textarea>
                        </div>
                        <div class="col-12">
                            <label class="form-label small text-muted">Deep Dive Narrative (Product Page)</label>
                            <textarea class="form-control bg-light border-0 p-3" id="edit-details" rows="5"></textarea>
                        </div>
                        <div class="col-12">
                            <label class="form-label small text-muted">Killer Features (Comma separated list)</label>
                            <input type="text" class="form-control bg-light border-0 p-3" id="edit-features">
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0 p-4 pt-0">
                    <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Discard
                        Changes</button>
                    <button type="button" class="btn btn-primary rounded-pill px-5" onclick="saveProduct()">Deploy
                        Content</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const editModal = new bootstrap.Modal(document.getElementById('editModal'));
        let currentProducts = [];

        function showSection(id) {
            $('[id^="section-"]').hide();
            $(`#section-${id}`).show();
            $('.nav-link').removeClass('active');
            $(event.currentTarget).addClass('active');
        }

        function loadContent() {
            fetch('/api/content')
                .then(res => res.json())
                .then(data => {
                    currentProducts = data.products;
                    $('#form-hero-title').val(data.settings.heroTitle);
                    $('#form-hero-subtitle').val(data.settings.heroSubtitle);
                    $('#stat-products').text(data.products.length);

                    const tableRows = data.products.map(p => `
                        <tr>
                            <td class="ps-4"><div class="bg-light p-2 rounded d-inline-block text-primary"><i class='bx ${p.icon} fs-4'></i></div></td>
                            <td class="fw-bold">${p.name}</td>
                            <td class="small opacity-75">${p.tagline}</td>
                            <td><span class="badge bg-light text-dark font-monospace">/${p.slug}</span></td>
                            <td class="text-end pe-4">
                                <button class="btn btn-sm btn-outline-primary rounded-pill px-3" onclick="openEdit(${p.id})">Edit Strategy</button>
                            </td>
                        </tr>
                    `).join('');
                    $('#products-table').html(tableRows);
                });

            fetch('/api/leads')
                .then(res => res.json())
                .then(leads => {
                    $('#stat-leads').text(leads.length);
                    const leadRows = leads.reverse().map(l => `
                        <tr>
                            <td class="ps-4">
                                <div class="fw-bold">${l.name}</div>
                                <div class="small text-muted">${l.email}</div>
                            </td>
                            <td><span class="badge bg-primary-subtle text-primary">${l.module}</span></td>
                            <td class="small opacity-75 text-truncate" style="max-width:300px">${l.message}</td>
                            <td><div class="small text-muted">${new Date(l.date).toLocaleDateString()}</div></td>
                        </tr>
                    `).join('');
                    $('#leads-table').html(leadRows || '<tr><td colspan="4" class="text-center py-5 opacity-50">No requests yet</td></tr>');
                });
        }

        $('#hero-form').on('submit', function (e) {
            e.preventDefault();
            const data = { heroTitle: $('#form-hero-title').val(), heroSubtitle: $('#form-hero-subtitle').val(), siteName: "Amarac BPA" };
            fetch('/api/settings', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) })
                .then(() => alert('Homepage strategies updated!'));
        });

        function openEdit(id) {
            const p = currentProducts.find(x => x.id === id);
            $('#edit-id').val(p.id); $('#edit-name').val(p.name); $('#edit-slug').val(p.slug);
            $('#edit-tagline').val(p.tagline); $('#edit-desc').val(p.description);
            $('#edit-details').val(p.details); $('#edit-features').val((p.features || []).join(', '));
            editModal.show();
        }

        function saveProduct() {
            const id = $('#edit-id').val();
            const data = {
                name: $('#edit-name').val(), slug: $('#edit-slug').val(),
                tagline: $('#edit-tagline').val(), description: $('#edit-desc').val(),
                details: $('#edit-details').val(), features: $('#edit-features').val().split(',').map(f => f.trim()).filter(f => f)
            };
            fetch(`/api/products/${id}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) })
                .then(() => { editModal.hide(); loadContent(); });
        }

        $(document).ready(loadContent);
    </script>
</body>

</html>